<!doctype html>
<html lang="es">
  <head>
    <script>
      // Redirigir al login si no hay usuario autenticado (se ejecuta antes de cargar la p√°gina)
      if (!localStorage.getItem("user")) {
        window.location.href = "/login.html";
      }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Biblioteca Virtual | Sistema de Gesti√≥n</title>
    <link rel="stylesheet" href="css/style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
  </head>
  <body>
    <header>
      <nav>
        <div class="logo">
          <i class="fas fa-book-reader"></i> BIBLIOTECA VIRTUAL
        </div>
        <ul id="nav-menu">
          <li><a href="index.html" class="active">Inicio</a></li>
          <li id="admin-menu" style="display: none">
            <a href="#" onclick="toggleAdminPanel()">Gestionar Inventario</a>
          </li>
          <li>
            <button
              id="dark-mode-toggle"
              onclick="toggleDarkMode()"
              title="Modo oscuro"
            >
              <i class="fas fa-moon"></i>
            </button>
          </li>
          <li id="profile-menu-item" style="display: none">
            <a href="#" onclick="showProfileModal()" title="Mi Perfil">
              <i class="fas fa-user-circle"></i> Perfil
            </a>
          </li>
          <li><a href="#" id="auth-link">Iniciar Sesi√≥n</a></li>
        </ul>
      </nav>
    </header>

    <main class="container">
      <section id="welcome-section" class="card welcome-hero">
        <div style="text-align: center; margin-bottom: 40px">
          <div style="font-size: 3.5rem; margin-bottom: 15px">üìö</div>
          <h1 style="font-size: 2.5rem; margin-bottom: 10px">
            Bienvenido a la Biblioteca Virtual
          </h1>
          <p
            id="welcome-message"
            style="font-size: 1.1rem; color: #64748b; margin: 0"
          >
            Gestiona tu colecci√≥n de libros, realiza pr√©stamos y mant√©n un
            registro completo de todas tus transacciones
          </p>
        </div>

        <!-- Cards de Informaci√≥n -->
        <div
          style="
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
          "
        >
          <!-- Card 1: Libros Totales -->
          <div
            style="
              background: linear-gradient(
                135deg,
                rgba(74, 144, 226, 0.1) 0%,
                rgba(0, 210, 255, 0.1) 100%
              );
              padding: 25px;
              border-radius: 15px;
              border-left: 4px solid var(--primary);
            "
          >
            <div style="font-size: 2.5rem; margin-bottom: 10px">üìñ</div>
            <p style="color: #64748b; margin: 0 0 8px 0; font-weight: 500">
              Libros Disponibles
            </p>
            <p
              style="
                font-size: 1.8rem;
                color: var(--primary);
                font-weight: 700;
                margin: 0;
              "
              id="total-books"
            >
              -
            </p>
          </div>

          <!-- Card 2: Pr√©stamos Activos (Solo Admin) -->
          <div
            id="admin-loans-card"
            style="
              background: linear-gradient(
                135deg,
                rgba(16, 185, 129, 0.1) 0%,
                rgba(74, 144, 226, 0.1) 100%
              );
              padding: 25px;
              border-radius: 15px;
              border-left: 4px solid var(--success);
              display: none;
            "
          >
            <div style="font-size: 2.5rem; margin-bottom: 10px">ü§ù</div>
            <p style="color: #64748b; margin: 0 0 8px 0; font-weight: 500">
              Registros de Pr√©stamo
            </p>
            <p
              style="
                font-size: 1.8rem;
                color: var(--success);
                font-weight: 700;
                margin: 0;
              "
              id="total-loans"
            >
              -
            </p>
          </div>

          <!-- Card 2b: Mi Progreso (Solo Usuarios) -->
          <div
            id="user-achievements-card"
            style="
              background: linear-gradient(
                135deg,
                rgba(59, 130, 246, 0.1) 0%,
                rgba(34, 197, 94, 0.1) 100%
              );
              padding: 25px;
              border-radius: 15px;
              border-left: 4px solid #3b82f6;
            "
          >
            <div style="font-size: 2.5rem; margin-bottom: 10px">üìö</div>
            <p style="color: #64748b; margin: 0 0 8px 0; font-weight: 500">
              Tu Actividad
            </p>
            <p
              style="
                font-size: 1.8rem;
                color: #3b82f6;
                font-weight: 700;
                margin: 0;
              "
              id="user-books-read"
            >
              0/0
            </p>
            <p style="color: #94a3b8; font-size: 0.85rem; margin: 8px 0 0 0">
              <span id="user-progress-pct">0</span>% del cat√°logo explorado
            </p>
          </div>

          <!-- Card 3: Rol/Informaci√≥n Personalizada -->
          <div
            id="user-role-card"
            style="
              background: linear-gradient(
                135deg,
                rgba(0, 210, 255, 0.1) 0%,
                rgba(244, 63, 94, 0.1) 100%
              );
              padding: 25px;
              border-radius: 15px;
              border-left: 4px solid var(--accent);
            "
          >
            <div style="font-size: 2.5rem; margin-bottom: 10px" id="role-icon">
              üë§
            </div>
            <p
              style="color: #64748b; margin: 0 0 8px 0; font-weight: 500"
              id="role-label"
            >
              Usuario
            </p>
            <p
              style="
                font-size: 1.8rem;
                color: var(--accent);
                font-weight: 700;
                margin: 0;
              "
              id="role-value"
            >
              Regular
            </p>
          </div>
        </div>

        <!-- Atajos R√°pidos -->
        <div
          style="
            margin-top: 40px;
            padding-top: 40px;
            border-top: 2px solid #e2e8f0;
          "
        >
          <h3 style="margin-bottom: 20px; color: #0f172a; font-size: 1.3rem">
            ‚ö° Acciones R√°pidas
          </h3>
          <div
            id="quick-actions"
            style="
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
              gap: 15px;
            "
          >
            <!-- Contenido din√°mico seg√∫n el rol -->
          </div>
        </div>

        <!-- Mensaje de Bienvenida Personalizado -->
        <div
          style="
            margin-top: 40px;
            padding: 25px;
            background: linear-gradient(
              135deg,
              var(--primary) 0%,
              var(--accent) 100%
            );
            border-radius: 15px;
            color: white;
            text-align: center;
          "
        >
          <p style="margin: 0; font-size: 1.1rem; font-weight: 600">
            ‚ú® Sistema listo para usar - Gestiona tu biblioteca de forma
            eficiente
          </p>
        </div>
      </section>

      <!-- Sistema de Pesta√±as para Administrador -->
      <div id="admin-tabs-container" style="display: none; margin-bottom: 30px">
        <div class="admin-tabs">
          <button class="tab-btn active" onclick="switchAdminTab('catalog')">
            <i class="fas fa-book"></i> Cat√°logo de Libros
          </button>
          <button class="tab-btn" onclick="switchAdminTab('inventory')">
            <i class="fas fa-tools"></i> Panel de Gesti√≥n
          </button>
          <button class="tab-btn" onclick="switchAdminTab('dashboard')">
            <i class="fas fa-chart-bar"></i> Dashboard
          </button>
          <button class="tab-btn" onclick="switchAdminTab('history')">
            <i class="fas fa-history"></i> Historial
          </button>
          <button class="tab-btn" onclick="switchAdminTab('users')">
            <i class="fas fa-users"></i> Usuarios
          </button>
        </div>
      </div>

      <!-- PESTA√ëA 1: Cat√°logo de Libros -->
      <section id="admin-catalog-tab" class="card admin-tab-content">
        <div class="admin-section">
          <div class="admin-section-title">
            <i class="fas fa-book"></i>
            <span>B√∫squeda y Filtros del Cat√°logo</span>
          </div>
          <!-- Barra de B√∫squeda y Filtros -->
          <div
            style="
              display: flex;
              gap: 12px;
              margin-bottom: 15px;
              flex-wrap: wrap;
            "
          >
            <!-- B√∫squeda por texto -->
            <input
              type="text"
              id="bookSearch"
              placeholder="üîç Buscar por t√≠tulo o autor..."
              onkeyup="filterBooks()"
              style="
                padding: 12px 16px;
                border-radius: 8px;
                border: 2px solid #e2e8f0;
                flex: 1;
                min-width: 250px;
                font-size: 0.95rem;
                background: white;
              "
            />

            <!-- Filtro por Categor√≠a -->
            <select
              id="categoryFilter"
              onchange="filterBooks()"
              style="
                padding: 12px 16px;
                border-radius: 8px;
                border: 2px solid #e2e8f0;
                background: white;
                cursor: pointer;
                min-width: 200px;
                font-size: 0.95rem;
              "
            >
              <option value="">üìÇ Todas las Categor√≠as</option>
            </select>

            <!-- Bot√≥n Limpiar Filtros -->
            <button
              onclick="clearFilters()"
              style="
                padding: 12px 20px;
                border-radius: 8px;
                border: 2px solid #e2e8f0;
                background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
                cursor: pointer;
                font-weight: 600;
                color: #0f172a;
                transition: all 0.2s ease;
              "
              onmouseover="
                this.style.background =
                  'linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%)'
              "
              onmouseout="
                this.style.background =
                  'linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%)'
              "
            >
              üîÑ Limpiar Filtros
            </button>

            <!-- Bot√≥n Descargar PDF del Cat√°logo -->
            <button
              onclick="downloadCatalogPDF()"
              style="
                padding: 12px 20px;
                border-radius: 8px;
                background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
                color: white;
                cursor: pointer;
                font-weight: 600;
                border: none;
                transition: all 0.2s ease;
                box-shadow: 0 4px 12px rgba(74, 144, 226, 0.3);
              "
              onmouseover="
                this.style.boxShadow = '0 6px 16px rgba(74, 144, 226, 0.5)'
              "
              onmouseout="
                this.style.boxShadow = '0 4px 12px rgba(74, 144, 226, 0.3)'
              "
            >
              üì• Descargar Cat√°logo
            </button>
          </div>
        </div>

        <div class="table-responsive">
          <table>
            <thead>
              <tr>
                <th>ID</th>
                <th>T√≠tulo</th>
                <th>Autor</th>
                <th>Stock Disponible</th>
                <th>Estado</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="book-table-body">
              <tr>
                <td colspan="6" style="text-align: center; padding: 40px">
                  <i class="fas fa-spinner fa-spin"></i> Cargando cat√°logo...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- PESTA√ëA: Gesti√≥n de Usuarios (Solo Admin) -->
      <section
        id="admin-users-tab"
        class="card admin-tab-content"
        style="display: none"
      >
        <div style="margin-bottom: 25px">
          <h2><i class="fas fa-users"></i> Gesti√≥n de Usuarios</h2>
          <p style="color: var(--text-secondary); margin-top: 8px">
            Administra los usuarios registrados. Edita datos, cambia roles o
            bloquea cuentas.
          </p>
        </div>
        <div
          id="users-cards-container"
          style="
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 20px;
          "
        >
          <div
            style="
              grid-column: 1/-1;
              text-align: center;
              padding: 40px;
              color: #94a3b8;
            "
          >
            <i
              class="fas fa-spinner fa-spin"
              style="font-size: 2rem; margin-bottom: 12px"
            ></i>
            <p>Cargando usuarios...</p>
          </div>
        </div>
      </section>

      <!-- PESTA√ëA 2: Panel de Gesti√≥n de Inventario -->
      <section
        id="admin-inventory-tab"
        class="card admin-tab-content"
        style="display: none"
      >
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
          "
        >
          <div>
            <h2><i class="fas fa-tools"></i> Panel de Gesti√≥n de Inventario</h2>
            <p style="color: var(--text-secondary); margin-top: 5px">
              Administra el stock y los libros del cat√°logo
            </p>
          </div>
          <button
            class="btn-loan"
            onclick="showAddModal()"
            style="white-space: nowrap"
          >
            <i class="fas fa-plus"></i> A√±adir Nuevo Libro
          </button>
        </div>
        <div class="table-responsive">
          <table>
            <thead>
              <tr>
                <th>ID</th>
                <th>T√≠tulo</th>
                <th>Autor</th>
                <th>Stock Total</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="admin-inventory-table-body"></tbody>
          </table>
        </div>
      </section>

      <!-- PESTA√ëA 4: Dashboard con Gr√°ficos (Solo Admin) -->
      <section
        id="admin-dashboard-tab"
        class="card admin-tab-content"
        style="display: none"
      >
        <div style="margin-bottom: 30px">
          <h2><i class="fas fa-chart-bar"></i> Dashboard de An√°lisis</h2>
          <p style="color: var(--text-secondary); margin-top: 8px">
            Visualiza m√©tricas y estad√≠sticas del sistema
          </p>
        </div>

        <div
          style="
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
          "
        >
          <!-- Gr√°fico de Libros M√°s Prestados -->
          <div
            style="
              background: linear-gradient(135deg, white 0%, #f8fafc 100%);
              padding: 24px;
              border-radius: 12px;
              box-shadow: 0 4px 15px rgba(15, 23, 42, 0.1);
              border: 1px solid rgba(74, 144, 226, 0.15);
            "
          >
            <h3 style="margin-bottom: 20px; color: #0f172a; font-weight: 700">
              üìö Top Libros Prestados
            </h3>
            <canvas id="chart-top-books"></canvas>
          </div>

          <!-- Gr√°fico de Actividad Mensual -->
          <div
            style="
              background: linear-gradient(135deg, white 0%, #f8fafc 100%);
              padding: 24px;
              border-radius: 12px;
              box-shadow: 0 4px 15px rgba(15, 23, 42, 0.1);
              border: 1px solid rgba(74, 144, 226, 0.15);
            "
          >
            <h3 style="margin-bottom: 20px; color: #0f172a; font-weight: 700">
              üìà Pr√©stamos por Mes
            </h3>
            <canvas id="chart-monthly-loans"></canvas>
          </div>

          <!-- Gr√°fico de Estado del Inventario -->
          <div
            style="
              background: linear-gradient(135deg, white 0%, #f8fafc 100%);
              padding: 24px;
              border-radius: 12px;
              box-shadow: 0 4px 15px rgba(15, 23, 42, 0.1);
              border: 1px solid rgba(74, 144, 226, 0.15);
            "
          >
            <h3 style="margin-bottom: 20px; color: #0f172a; font-weight: 700">
              üìä Disponibilidad de Libros
            </h3>
            <canvas id="chart-availability"></canvas>
          </div>

          <!-- Gr√°fico de Usuarios M√°s Activos -->
          <div
            style="
              background: linear-gradient(135deg, white 0%, #f8fafc 100%);
              padding: 24px;
              border-radius: 12px;
              box-shadow: 0 4px 15px rgba(15, 23, 42, 0.1);
              border: 1px solid rgba(74, 144, 226, 0.15);
            "
          >
            <h3 style="margin-bottom: 20px; color: #0f172a; font-weight: 700">
              üë• Usuarios Activos
            </h3>
            <canvas id="chart-top-users"></canvas>
          </div>

          <!-- Estad√≠sticas R√°pidas -->
          <div
            style="
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              color: white;
              padding: 24px;
              border-radius: 12px;
              display: flex;
              flex-direction: column;
              justify-content: center;
              box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
            "
          >
            <div style="margin-bottom: 20px">
              <p
                style="
                  font-size: 0.85rem;
                  opacity: 0.9;
                  margin: 0;
                  font-weight: 600;
                "
              >
                Total de Pr√©stamos
              </p>
              <p
                id="stat-total-loans"
                style="font-size: 2.5rem; font-weight: 800; margin: 8px 0 0 0"
              >
                -
              </p>
            </div>
            <div
              style="
                border-top: 1px solid rgba(255, 255, 255, 0.2);
                padding-top: 20px;
              "
            >
              <p
                style="
                  font-size: 0.85rem;
                  opacity: 0.9;
                  margin: 0;
                  font-weight: 600;
                "
              >
                Libros Disponibles
              </p>
              <p
                id="stat-available-books"
                style="font-size: 2.5rem; font-weight: 800; margin: 8px 0 0 0"
              >
                -
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- PESTA√ëA 3: Historial de Pr√©stamos -->
      <section
        id="admin-history-tab"
        class="card admin-tab-content"
        style="display: none"
      >
        <div style="margin-bottom: 30px">
          <h2><i class="fas fa-history"></i> Historial de Pr√©stamos</h2>
          <p style="color: var(--text-secondary); margin-top: 8px">
            Registros de todas las transacciones del sistema
          </p>
        </div>
        <div class="table-responsive">
          <table>
            <thead>
              <tr>
                <th>Libro</th>
                <th>Usuario</th>
                <th>Fecha</th>
                <th>Estado</th>
              </tr>
            </thead>
            <tbody id="history-table-body"></tbody>
          </table>
        </div>
      </section>

      <!-- SECCI√ìN: Mis Pr√©stamos para Usuarios -->
      <section
        id="my-loans-section"
        class="card admin-tab-content"
        style="display: none"
      >
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
          "
        >
          <h2><i class="fas fa-hand-holding"></i> Mis Pr√©stamos Activos</h2>
          <div style="display: flex; gap: 10px">
            <button
              onclick="downloadLoansCSV()"
              style="
                padding: 8px 12px;
                background: #10b981;
                color: white;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                font-weight: 600;
              "
            >
              üìä CSV
            </button>
            <button
              onclick="downloadLoansPDF()"
              style="
                padding: 8px 12px;
                background: #ef4444;
                color: white;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                font-weight: 600;
              "
            >
              üìÑ PDF
            </button>
          </div>
        </div>
        <p style="color: #64748b; margin-bottom: 20px">
          Libros que tienes prestados actualmente. Plazo de devoluci√≥n: 14 d√≠as
          desde la fecha de pr√©stamo.
        </p>
        <div class="table-responsive">
          <table>
            <thead>
              <tr>
                <th>Libro</th>
                <th>Fecha Pr√©stamo</th>
                <th>Fecha Devoluci√≥n</th>
                <th>D√≠as Restantes</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="my-loans-table-body">
              <tr>
                <td
                  colspan="5"
                  style="text-align: center; padding: 40px; color: #94a3b8"
                >
                  <i class="fas fa-inbox"></i><br />
                  No tienes pr√©stamos activos
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- SECCI√ìN: Mis Favoritos -->
      <section
        id="my-favorites-section"
        class="card admin-tab-content"
        style="display: none"
      >
        <h2><i class="fas fa-heart"></i> Mis Favoritos</h2>
        <p style="color: #64748b; margin-bottom: 20px">
          Tus libros favoritos marcados para lectura futura.
        </p>
        <div class="table-responsive">
          <table>
            <thead>
              <tr>
                <th>T√≠tulo</th>
                <th>Autor</th>
                <th>Categor√≠a</th>
                <th>Disponibilidad</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="favorites-table-body">
              <tr>
                <td
                  colspan="5"
                  style="text-align: center; padding: 40px; color: #94a3b8"
                >
                  <i class="fas fa-bookmark"></i><br />
                  No tienes favoritos guardados. ¬°Comienza a a√±adir libros!
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>
    </main>

    <div id="book-detail-modal" class="modal" style="display: none">
      <div class="modal-content card">
        <button
          onclick="closeBookDetailModal()"
          style="
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
          "
        >
          ‚úï
        </button>
        <h2 id="detail-title">Detalles del Libro</h2>
        <div id="book-details-content"></div>
      </div>
    </div>

    <div id="book-modal" class="modal" style="display: none">
      <div
        class="modal-content card"
        style="
          max-width: 650px;
          border-radius: 12px;
          box-shadow: 0 20px 60px rgba(15, 23, 42, 0.3);
          max-height: 90vh;
          overflow-y: auto;
        "
      >
        <div
          style="
            background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
            color: white;
            padding: 20px;
            border-radius: 12px 12px 0 0;
          "
        >
          <h2
            id="modal-title"
            style="
              margin: 0;
              display: flex;
              align-items: center;
              gap: 12px;
              font-size: 1.4rem;
            "
          >
            <i class="fas fa-book-plus"></i> Nuevo Libro
          </h2>
        </div>
        <form
          id="book-form"
          enctype="multipart/form-data"
          style="padding: 24px"
        >
          <!-- Fila 1: ID y T√≠tulo -->
          <div
            style="
              display: grid;
              grid-template-columns: 1fr 1fr;
              gap: 16px;
              margin-bottom: 16px;
            "
          >
            <div class="form-group">
              <label
                style="
                  font-weight: 600;
                  color: #0f172a;
                  margin-bottom: 8px;
                  display: block;
                "
                >ID del Libro</label
              >
              <input
                type="text"
                id="bookId"
                required
                style="
                  padding: 10px 14px;
                  border: 2px solid #e2e8f0;
                  border-radius: 8px;
                  width: 100%;
                  font-size: 0.95rem;
                "
              />
            </div>
            <div class="form-group">
              <label
                style="
                  font-weight: 600;
                  color: #0f172a;
                  margin-bottom: 8px;
                  display: block;
                "
                >T√≠tulo</label
              >
              <input
                type="text"
                id="title"
                required
                style="
                  padding: 10px 14px;
                  border: 2px solid #e2e8f0;
                  border-radius: 8px;
                  width: 100%;
                  font-size: 0.95rem;
                "
              />
            </div>
          </div>

          <!-- Fila 2: Autor y ISBN -->
          <div
            style="
              display: grid;
              grid-template-columns: 1fr 1fr;
              gap: 16px;
              margin-bottom: 16px;
            "
          >
            <div class="form-group">
              <label
                style="
                  font-weight: 600;
                  color: #0f172a;
                  margin-bottom: 8px;
                  display: block;
                "
                >Autor</label
              >
              <input
                type="text"
                id="author"
                required
                style="
                  padding: 10px 14px;
                  border: 2px solid #e2e8f0;
                  border-radius: 8px;
                  width: 100%;
                  font-size: 0.95rem;
                "
              />
            </div>
            <div class="form-group">
              <label
                style="
                  font-weight: 600;
                  color: #0f172a;
                  margin-bottom: 8px;
                  display: block;
                "
                >ISBN</label
              >
              <input
                type="text"
                id="isbn"
                required
                style="
                  padding: 10px 14px;
                  border: 2px solid #e2e8f0;
                  border-radius: 8px;
                  width: 100%;
                  font-size: 0.95rem;
                "
              />
            </div>
          </div>

          <!-- Fila 3: Categor√≠a y Cantidad -->
          <div
            style="
              display: grid;
              grid-template-columns: 1fr 1fr;
              gap: 16px;
              margin-bottom: 16px;
            "
          >
            <div class="form-group">
              <label
                style="
                  font-weight: 600;
                  color: #0f172a;
                  margin-bottom: 8px;
                  display: block;
                "
                >Categor√≠a</label
              >
              <select
                id="bookCategory"
                required
                style="
                  padding: 10px 14px;
                  border: 2px solid #e2e8f0;
                  border-radius: 8px;
                  width: 100%;
                  font-size: 0.95rem;
                  background: white;
                "
              >
                <option value="">Selecciona una</option>
              </select>
            </div>
            <div class="form-group">
              <label
                style="
                  font-weight: 600;
                  color: #0f172a;
                  margin-bottom: 8px;
                  display: block;
                "
                >Cantidad</label
              >
              <input
                type="number"
                id="quantity"
                min="1"
                required
                style="
                  padding: 10px 14px;
                  border: 2px solid #e2e8f0;
                  border-radius: 8px;
                  width: 100%;
                  font-size: 0.95rem;
                "
              />
            </div>
          </div>

          <!-- Nueva Categor√≠a (oculta/compacta) -->
          <div class="form-group" style="margin-bottom: 16px">
            <label
              style="
                font-weight: 600;
                color: #0f172a;
                margin-bottom: 8px;
                display: block;
                font-size: 0.9rem;
              "
            >
              <i
                class="fas fa-plus-circle"
                style="color: #4a90e2; margin-right: 6px"
              ></i>
              Nueva Categor√≠a (opcional)
            </label>
            <input
              type="text"
              id="newCategory"
              placeholder="Escribe aqu√≠..."
              style="
                padding: 10px 14px;
                border: 2px solid #f1f5f9;
                border-radius: 8px;
                width: 100%;
                font-size: 0.95rem;
                background: #f8fafc;
              "
            />
          </div>

          <!-- Descripci√≥n -->
          <div class="form-group" style="margin-bottom: 16px">
            <label
              style="
                font-weight: 600;
                color: #0f172a;
                margin-bottom: 8px;
                display: block;
              "
              >Descripci√≥n</label
            >
            <textarea
              id="description"
              rows="2"
              placeholder="Ingresa una descripci√≥n breve..."
              style="
                padding: 10px 14px;
                border: 2px solid #e2e8f0;
                border-radius: 8px;
                width: 100%;
                font-size: 0.95rem;
                font-family: inherit;
              "
            ></textarea>
          </div>

          <!-- Imagen -->
          <div class="form-group" style="margin-bottom: 20px">
            <label
              style="
                font-weight: 600;
                color: #0f172a;
                margin-bottom: 8px;
                display: block;
              "
              >Imagen de Portada</label
            >
            <input
              type="file"
              id="coverImage"
              accept="image/*"
              style="
                padding: 10px 14px;
                border: 2px dashed #e2e8f0;
                border-radius: 8px;
                width: 100%;
                font-size: 0.9rem;
                background: #f8fafc;
              "
            />
            <small style="color: #64748b; font-size: 0.85rem"
              >JPG, PNG (opcional)</small
            >
          </div>

          <!-- Botones -->
          <div
            style="
              display: flex;
              gap: 12px;
              padding-top: 16px;
              border-top: 2px solid #e2e8f0;
            "
          >
            <button
              type="submit"
              class="action-btn edit"
              style="
                flex: 1;
                padding: 12px 20px;
                font-size: 0.95rem;
                justify-content: center;
              "
            >
              <i class="fas fa-save"></i> Guardar Libro
            </button>
            <button
              type="button"
              onclick="closeModal()"
              class="action-btn delete"
              style="
                flex: 1;
                padding: 12px 20px;
                font-size: 0.95rem;
                justify-content: center;
              "
            >
              <i class="fas fa-times"></i> Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal Edici√≥n Usuario -->
    <div id="user-modal" class="modal" style="display: none">
      <div
        class="modal-content card"
        style="
          max-width: 700px;
          border-radius: 12px;
          box-shadow: 0 20px 60px rgba(15, 23, 42, 0.3);
        "
      >
        <div
          style="
            background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
            color: white;
            padding: 24px;
            border-radius: 12px 12px 0 0;
          "
        >
          <h2
            id="user-modal-title"
            style="margin: 0; display: flex; align-items: center; gap: 12px"
          >
            <i class="fas fa-user-edit"></i> Editar Usuario
          </h2>
        </div>
        <div style="padding: 24px">
          <div
            style="
              display: grid;
              grid-template-columns: 1fr 1fr;
              gap: 16px;
              margin-bottom: 20px;
            "
          >
            <div class="form-group">
              <label
                style="
                  font-weight: 600;
                  color: #0f172a;
                  margin-bottom: 8px;
                  display: block;
                "
                >Usuario</label
              >
              <input
                type="text"
                id="edit-username"
                disabled
                style="
                  background: #f1f5f9;
                  cursor: not-allowed;
                  font-weight: 600;
                "
              />
            </div>
            <div class="form-group">
              <label
                style="
                  font-weight: 600;
                  color: #0f172a;
                  margin-bottom: 8px;
                  display: block;
                "
                >Rol</label
              >
              <select
                id="edit-role"
                style="
                  padding: 12px 16px;
                  border: 2px solid #e2e8f0;
                  border-radius: 8px;
                  font-size: 0.95rem;
                "
              >
                <option value="user">üë§ Usuario</option>
                <option value="admin">üîë Administrador</option>
              </select>
            </div>
          </div>

          <div
            style="
              display: grid;
              grid-template-columns: 1fr 1fr;
              gap: 16px;
              margin-bottom: 20px;
            "
          >
            <div class="form-group">
              <label
                style="
                  font-weight: 600;
                  color: #0f172a;
                  margin-bottom: 8px;
                  display: block;
                "
                >Nombre</label
              >
              <input
                type="text"
                id="edit-name"
                style="
                  padding: 12px 16px;
                  border: 2px solid #e2e8f0;
                  border-radius: 8px;
                  width: 100%;
                  font-size: 0.95rem;
                "
              />
            </div>
            <div class="form-group">
              <label
                style="
                  font-weight: 600;
                  color: #0f172a;
                  margin-bottom: 8px;
                  display: block;
                "
                >Apellido</label
              >
              <input
                type="text"
                id="edit-lastname"
                style="
                  padding: 12px 16px;
                  border: 2px solid #e2e8f0;
                  border-radius: 8px;
                  width: 100%;
                  font-size: 0.95rem;
                "
              />
            </div>
          </div>

          <div
            style="
              display: grid;
              grid-template-columns: 1fr 1fr;
              gap: 16px;
              margin-bottom: 20px;
            "
          >
            <div class="form-group">
              <label
                style="
                  font-weight: 600;
                  color: #0f172a;
                  margin-bottom: 8px;
                  display: block;
                "
                >Correo</label
              >
              <input
                type="email"
                id="edit-email"
                style="
                  padding: 12px 16px;
                  border: 2px solid #e2e8f0;
                  border-radius: 8px;
                  width: 100%;
                  font-size: 0.95rem;
                "
              />
            </div>
            <div class="form-group">
              <label
                style="
                  font-weight: 600;
                  color: #0f172a;
                  margin-bottom: 8px;
                  display: block;
                "
                >Tel√©fono</label
              >
              <input
                type="text"
                id="edit-phone"
                style="
                  padding: 12px 16px;
                  border: 2px solid #e2e8f0;
                  border-radius: 8px;
                  width: 100%;
                  font-size: 0.95rem;
                "
              />
            </div>
          </div>

          <div
            style="
              display: flex;
              gap: 12px;
              margin-top: 24px;
              padding-top: 20px;
              border-top: 2px solid #e2e8f0;
            "
          >
            <button
              onclick="saveUserChanges()"
              class="action-btn edit"
              style="
                flex: 1;
                padding: 12px 20px;
                font-size: 0.95rem;
                justify-content: center;
              "
            >
              <i class="fas fa-save"></i> Guardar Cambios
            </button>
            <button
              onclick="
                toggleBlockCurrentUser(
                  document.getElementById('edit-username').value,
                )
              "
              id="btn-block-user"
              class="action-btn block"
              style="
                flex: 1;
                padding: 12px 20px;
                font-size: 0.95rem;
                justify-content: center;
              "
            >
              <i class="fas fa-lock"></i> Bloquear Usuario
            </button>
            <button
              onclick="closeUserModal()"
              class="action-btn delete"
              style="
                flex: 1;
                padding: 12px 20px;
                font-size: 0.95rem;
                justify-content: center;
              "
            >
              <i class="fas fa-times"></i> Cerrar
            </button>
          </div>
        </div>
      </div>
    </div>

    <div id="notification-container"></div>

    <!-- Modal de Perfil de Usuario -->
    <div id="profile-modal" class="modal" style="display: none">
      <div
        class="modal-content"
        style="max-width: 600px; max-height: 80vh; overflow-y: auto"
      >
        <div class="modal-header">
          <h2><i class="fas fa-user-circle"></i> Mi Perfil</h2>
          <button
            class="close-btn"
            onclick="closeProfileModal()"
            style="
              background: none;
              border: none;
              font-size: 1.5rem;
              cursor: pointer;
            "
          >
            ‚úï
          </button>
        </div>

        <div class="modal-body" style="padding: 20px">
          <!-- Secci√≥n de Perfil Editable -->
          <div style="margin-bottom: 25px">
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 15px;
              "
            >
              <h3 style="margin: 0">
                <i class="fas fa-id-card"></i> Informaci√≥n Personal
              </h3>
              <button
                id="btn-edit-profile"
                onclick="toggleEditProfile(true)"
                style="
                  padding: 6px 12px;
                  background: #3b82f6;
                  color: white;
                  border: none;
                  border-radius: 5px;
                  cursor: pointer;
                  font-size: 0.9rem;
                "
              >
                ‚úé Editar
              </button>
            </div>

            <!-- Vista Lectura -->
            <div id="profile-view-mode">
              <div
                style="padding: 15px; background: #f8fafc; border-radius: 8px"
              >
                <p style="margin: 8px 0">
                  <strong>üë§ Usuario:</strong>
                  <span id="profile-username"></span>
                </p>
                <p style="margin: 8px 0">
                  <strong>üìß Email:</strong> <span id="profile-email">N/A</span>
                </p>
                <p style="margin: 8px 0">
                  <strong>üìù Bio:</strong> <span id="profile-bio">Sin bio</span>
                </p>
                <p style="margin: 8px 0">
                  <strong>üë• Rol:</strong> <span id="profile-role"></span>
                </p>
                <p style="margin: 8px 0">
                  <strong>üìÖ Miembro desde:</strong>
                  <span id="profile-date"></span>
                </p>
                <p style="margin: 8px 0">
                  <strong>üé¨ G√©neros Favoritos:</strong>
                  <span id="profile-genres">No especificados</span>
                </p>
              </div>
            </div>

            <!-- Formulario Edici√≥n -->
            <div id="profile-edit-mode" style="display: none">
              <div
                style="padding: 15px; background: #f0f9ff; border-radius: 8px"
              >
                <div style="margin-bottom: 12px">
                  <label
                    style="display: block; margin-bottom: 5px; font-weight: 500"
                    >Nombre:</label
                  >
                  <input
                    type="text"
                    id="edit-name"
                    placeholder="Tu nombre"
                    style="
                      width: 100%;
                      padding: 8px 12px;
                      border: 1px solid #ddd;
                      border-radius: 5px;
                      box-sizing: border-box;
                    "
                  />
                </div>
                <div style="margin-bottom: 12px">
                  <label
                    style="display: block; margin-bottom: 5px; font-weight: 500"
                    >Bio:</label
                  >
                  <textarea
                    id="edit-bio"
                    placeholder="Cu√©ntanos sobre ti..."
                    style="
                      width: 100%;
                      padding: 8px 12px;
                      border: 1px solid #ddd;
                      border-radius: 5px;
                      box-sizing: border-box;
                      resize: vertical;
                      height: 80px;
                    "
                  ></textarea>
                </div>
                <div style="margin-bottom: 12px">
                  <label
                    style="display: block; margin-bottom: 5px; font-weight: 500"
                    >Foto de Perfil (URL):</label
                  >
                  <input
                    type="url"
                    id="edit-photo"
                    placeholder="https://ejemplo.com/foto.jpg"
                    style="
                      width: 100%;
                      padding: 8px 12px;
                      border: 1px solid #ddd;
                      border-radius: 5px;
                      box-sizing: border-box;
                    "
                  />
                </div>
                <div style="margin-bottom: 15px">
                  <label
                    style="display: block; margin-bottom: 5px; font-weight: 500"
                    >G√©neros Favoritos (separados por coma):</label
                  >
                  <input
                    type="text"
                    id="edit-genres"
                    placeholder="Ficci√≥n, Misterio, Ciencia Ficci√≥n"
                    style="
                      width: 100%;
                      padding: 8px 12px;
                      border: 1px solid #ddd;
                      border-radius: 5px;
                      box-sizing: border-box;
                    "
                  />
                </div>
                <div style="display: flex; gap: 10px">
                  <button
                    onclick="saveProfileChanges()"
                    style="
                      flex: 1;
                      padding: 10px;
                      background: #10b981;
                      color: white;
                      border: none;
                      border-radius: 5px;
                      cursor: pointer;
                      font-weight: 600;
                    "
                  >
                    ‚úì Guardar
                  </button>
                  <button
                    onclick="toggleEditProfile(false)"
                    style="
                      flex: 1;
                      padding: 10px;
                      background: #ef4444;
                      color: white;
                      border: none;
                      border-radius: 5px;
                      cursor: pointer;
                      font-weight: 600;
                    "
                  >
                    ‚úï Cancelar
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Formulario Cambio de Contrase√±a -->
          <div style="border-top: 1px solid #e2e8f0; padding-top: 20px">
            <h3 style="margin-top: 0">üîê Cambiar Contrase√±a</h3>
            <div style="margin-bottom: 15px">
              <label
                style="display: block; margin-bottom: 5px; font-weight: 500"
                >Contrase√±a Actual:</label
              >
              <input
                type="password"
                id="current-password"
                placeholder="Ingresa tu contrase√±a actual"
                style="
                  width: 100%;
                  padding: 8px 12px;
                  border: 1px solid #ddd;
                  border-radius: 5px;
                  box-sizing: border-box;
                "
              />
            </div>
            <div style="margin-bottom: 15px">
              <label
                style="display: block; margin-bottom: 5px; font-weight: 500"
                >Nueva Contrase√±a:</label
              >
              <input
                type="password"
                id="new-password"
                placeholder="Ingresa tu nueva contrase√±a"
                style="
                  width: 100%;
                  padding: 8px 12px;
                  border: 1px solid #ddd;
                  border-radius: 5px;
                  box-sizing: border-box;
                "
              />
            </div>
            <div style="margin-bottom: 20px">
              <label
                style="display: block; margin-bottom: 5px; font-weight: 500"
                >Confirmar Nueva Contrase√±a:</label
              >
              <input
                type="password"
                id="confirm-password"
                placeholder="Confirma tu nueva contrase√±a"
                style="
                  width: 100%;
                  padding: 8px 12px;
                  border: 1px solid #ddd;
                  border-radius: 5px;
                  box-sizing: border-box;
                "
              />
            </div>
            <button
              onclick="changePassword()"
              style="
                width: 100%;
                padding: 10px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                font-weight: 600;
                transition: all 0.3s;
              "
              onmouseover="this.opacity = '0.9'"
              onmouseout="this.opacity = '1'"
            >
              Guardar Nueva Contrase√±a
            </button>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <p>
        &copy; 2026 Biblioteca Virtual, SENA. Todos los derechos reservados.
      </p>
    </footer>

    <script src="js/toast.js"></script>
    <script src="js/app.js"></script>
  </body>
</html>
